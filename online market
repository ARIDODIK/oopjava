import java.util.ArrayList;
import java.util.List;

// Класс Category для представления категорий товаров
class Category {
    private String name;
    private List<Product> products;

    public Category(String name) {
        this.name = name;
        this.products = new ArrayList<>();
    }

    // Getter for category name
    public String getName() {
        return name;
    }

    // Attempt to set category name with validation
    public boolean trySetName(String name) {
        if (name != null && name.trim().length() >= 2) {
            this.name = name.trim();
            return true;
        }
        return false;
    }

    // Add product with validation checks
    public boolean addProduct(Product product) {
        // Check for null and duplicates
        if (product == null || products.contains(product)) {
            return false;
        }
        products.add(product);
        return true;
    }

    // Remove product
    public boolean removeProduct(Product product) {
        return products.remove(product);
    }

    // Getter for products list
    public List<Product> getProducts() {
        return new ArrayList<>(products); // Return copy for encapsulation
    }
}

// Класс Product для представления товаров с инкапсуляцией и валидацией
class Product {
    // Private fields for encapsulation
    private String id;
    private String name;
    private String description;
    private double price;
    private int quantity;
    private Category category;

    public Product(String id, String name, String description, double price, int quantity, Category category) {
        // Initialize fields with validation
        this.id = (id != null && id.trim().length() >= 2) ? id.trim() : "default";
        this.name = (name != null && name.trim().length() >= 2) ? name.trim() : "default";
        this.description = (description == null) ? null : 
                          (description.trim().length() <= 200) ? description.trim() : null;
        this.price = (price >= 0.0 && price <= 1_000_000.0) ? price : 0.0;
        this.quantity = (quantity >= 0 && quantity <= 1_000_000) ? quantity : 0;
        this.category = (category != null) ? category : null;
    }

    // Getters (read-only access)
    public String getId() { return id; }
    public String getName() { return name; }
    public String getDescription() { return description; }
    public double getPrice() { return price; }
    public int getQuantity() { return quantity; }
    public Category getCategory() { return category; }

    // Guarded mutators (protected setters with validation)
    
    public boolean trySetId(String id) {
        // Validation: not null, trimmed length >= 2
        if (id != null && id.trim().length() >= 2) {
            this.id = id.trim();
            return true;
        }
        return false;
    }

    public boolean trySetName(String name) {
        // Validation: not null, trimmed length >= 2
        if (name != null && name.trim().length() >= 2) {
            this.name = name.trim();
            return true;
        }
        return false;
    }

    public boolean trySetDescription(String description) {
        // Validation: can be null or trimmed length <= 200
        if (description == null) {
            this.description = null;
            return true;
        }
        String trimmed = description.trim();
        if (trimmed.length() <= 200) {
            this.description = trimmed;
            return true;
        }
        return false;
    }

    public boolean trySetPrice(double price) {
        // Validation: price between 0.0 and 1,000,000.0
        if (price >= 0.0 && price <= 1_000_000.0) {
            this.price = price;
            return true;
        }
        return false;
    }

    public boolean trySetQuantity(int quantity) {
        // Validation: quantity between 0 and 1,000,000
        if (quantity >= 0 && quantity <= 1_000_000) {
            this.quantity = quantity;
            return true;
        }
        return false;
    }

    public boolean trySetCategory(Category category) {
        // Validation: category not null
        if (category != null) {
            this.category = category;
            return true;
        }
        return false;
    }

    // Inventory management methods
    
    public boolean addStock(int amount) {
        // Validation: amount > 0 and new quantity within limits
        if (amount > 0) {
            long newQuantity = (long) this.quantity + amount;
            if (newQuantity <= 1_000_000) {
                this.quantity = (int) newQuantity;
                return true;
            }
        }
        return false;
    }

    public boolean sellProduct(int amount) {
        // Validation: amount > 0 and sufficient stock available
        if (amount > 0 && amount <= this.quantity) {
            this.quantity -= amount;
            return true;
        }
        return false;
    }

    public boolean applyDiscount(double percent) {
        // Validation: discount between 0 and 90%
        if (percent >= 0 && percent <= 90) {
            this.price = this.price * (1 - percent / 100);
            return true;
        }
        return false;
    }

    // Preview discount without changing price
    public double previewDiscount(double percent) {
        if (percent >= 0 && percent <= 90) {
            return this.price * (1 - percent / 100);
        }
        return this.price; // Return original price if discount invalid
    }

    // Calculate total inventory value
    public double calculateTotalValue() {
        return this.price * this.quantity;
    }

    // Computed stock status
    public String getStockStatus() {
        if (this.quantity == 0) {
            return "OUT_OF_STOCK";
        } else if (this.quantity <= 10) {
            return "LOW";
        } else {
            return "IN_STOCK";
        }
    }

    @Override
    public String toString() {
        return String.format("Product{id='%s', name='%s', price=%.2f, quantity=%d, status=%s}", 
                           id, name, price, quantity, getStockStatus());
    }
}

// Главный демонстрационный класс
public class Main {
    public static void main(String[] args) {
        System.out.println("=== Encapsulation and Validation Demo ===\n");

        // Create category
        Category stationery = new Category("Stationery");
        System.out.println("Created category: " + stationery.getName());

        // Create product
        Product pen = new Product("P001", "Pen", "Blue ballpoint pen", 50.0, 5, stationery);
        System.out.println("Created product: " + pen);
        System.out.println();

        // Demonstrate accepted operations
        System.out.println("=== ACCEPTED OPERATIONS ===");
        
        // 1. Successful price change
        boolean priceResult = pen.trySetPrice(250.0);
        System.out.println("trySetPrice(250.0): " + priceResult + " | New price: " + pen.getPrice());

        // 2. Successful stock addition
        boolean stockResult = pen.addStock(20);
        System.out.println("addStock(20): " + stockResult + " | New quantity: " + pen.getQuantity());
        System.out.println("Stock status: " + pen.getStockStatus());
        
        // 3. Successful sale
        boolean sellResult = pen.sellProduct(10);
        System.out.println("sellProduct(10): " + sellResult + " | Quantity after sale: " + pen.getQuantity());
        System.out.println();

        // Demonstrate rejected operations
        System.out.println("=== REJECTED OPERATIONS ===");
        
        // 1. Invalid price (negative)
        boolean invalidPrice = pen.trySetPrice(-1.0);
        System.out.println("trySetPrice(-1.0): " + invalidPrice + " | Price remains: " + pen.getPrice());

        // 2. Invalid name (too short)
        boolean invalidName = pen.trySetName("A");
        System.out.println("trySetName('A'): " + invalidName + " | Name remains: " + pen.getName());

        // 3. Sell more than available
        boolean invalidSale = pen.sellProduct(10000);
        System.out.println("sellProduct(10000): " + invalidSale + " | Quantity remains: " + pen.getQuantity());

        // 4. Invalid discount
        boolean invalidDiscount = pen.applyDiscount(200);
        System.out.println("applyDiscount(200): " + invalidDiscount + " | Price remains: " + pen.getPrice());

        // 5. Preview invalid discount
        double previewPrice = pen.previewDiscount(200);
        System.out.println("previewDiscount(200): returns original price: " + previewPrice);
        System.out.println();

        // Demonstrate category operations
        System.out.println("=== CATEGORY OPERATIONS ===");
        
        // First product addition to category
        boolean firstAdd = stationery.addProduct(pen);
        System.out.println("First product addition to category: " + firstAdd);
        
        // Attempt to add duplicate
        boolean duplicateAdd = stationery.addProduct(pen);
        System.out.println("Attempt to add duplicate: " + duplicateAdd);
        
        // Attempt to add null
        boolean nullAdd = stationery.addProduct(null);
        System.out.println("Attempt to add null: " + nullAdd);
        System.out.println();

        // Additional tests
        System.out.println("=== ADDITIONAL TESTS ===");
        
        // Test stock statuses
        Product testProduct = new Product("T001", "Test", "Test product", 10.0, 0, stationery);
        System.out.println("Product with quantity 0: " + testProduct.getStockStatus());
        
        testProduct.addStock(5);
        System.out.println("After adding 5: " + testProduct.getStockStatus());
        
        testProduct.addStock(10);
        System.out.println("After adding 10 more: " + testProduct.getStockStatus());
        System.out.println();

        // Final state
        System.out.println("=== FINAL STATE ===");
        System.out.println("Main product: " + pen);
        System.out.println("Total value: " + pen.calculateTotalValue());
        System.out.println("Products in category: " + stationery.getProducts().size());
        
        // Demonstrate successful discount
        boolean validDiscount = pen.applyDiscount(10);
        System.out.println("applyDiscount(10): " + validDiscount + " | Discounted price: " + pen.getPrice());
    }
}
